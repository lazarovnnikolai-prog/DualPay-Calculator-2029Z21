<!DOCTYPE html>
<html lang="bg">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DualPay – Ресто BGN / EUR</title>

<link href="https://fonts.googleapis.com/css2?family=Comfortaa:wght@600&family=Montserrat:wght@400;600&display=swap" rel="stylesheet">
<script src="https://cdn.tailwindcss.com"></script>

<meta name="theme-color" content="#14532D">

<style>
body{
  font-family:'Montserrat',sans-serif;
  background:radial-gradient(circle at top,#1f3d2b,#0f2a1d 60%);
  min-height:100vh;
}
h1{font-family:'Comfortaa',cursive}
.glass{
  background:linear-gradient(180deg,rgba(255,255,255,.92),rgba(235,245,240,.88));
  backdrop-filter:blur(18px);
}
.input-forest{
  background:linear-gradient(180deg,#f7fcfa,#e2efe9);
  border:1px solid #94b8a2;
}
.logo{
  background:#14532D;
  color:white;
  font-family:'Comfortaa';
  font-weight:bold;
  padding:12px;
  border-radius:1rem;
  text-align:center;
}
</style>
</head>

<body class="flex items-center justify-center">

<div class="w-full max-w-md mx-4 glass rounded-3xl shadow-2xl p-6 space-y-4">

  <div class="logo">€ ⇄ лв</div>
  <h1 class="text-center text-2xl text-[#14532D]">DualPay</h1>

  <div>
    <label class="text-sm font-semibold">Сума за плащане</label>
    <div class="flex gap-2">
      <input id="due" type="number" step="0.01" class="flex-1 rounded-xl p-3 input-forest">
      <select id="dueCur" class="rounded-xl p-3 input-forest">
        <option>BGN</option>
        <option>EUR</option>
      </select>
    </div>
  </div>

  <div class="grid grid-cols-2 gap-3">
    <input id="paidBGN" type="number" step="0.01" placeholder="Платено лв" class="rounded-xl p-3 input-forest">
    <input id="paidEUR" type="number" step="0.01" placeholder="Платено €" class="rounded-xl p-3 input-forest">
  </div>

  <div id="error" class="hidden bg-red-200 text-red-900 p-3 rounded-xl text-center font-semibold">
    Недостатъчна сума
  </div>

  <div id="result" class="hidden bg-white rounded-xl p-4 text-center">
    <div id="changeMain" class="text-2xl font-bold text-[#14532D]"></div>
    <div id="changeAlt" class="text-sm text-gray-600"></div>
  </div>

  <!-- INSTALL BUTTON -->
  <button id="installBtn"
    class="hidden w-full py-3 rounded-xl bg-[#14532D] text-white font-semibold shadow-lg">
    Инсталирай приложението
  </button>

  <div class="text-center text-xs text-gray-500">
    Курс: 1 EUR = 1.95583 BGN<br>
    © Nikolai Lazarov
  </div>
</div>

<script>
/* === LOGIC === */
const rate=1.95583;
const due=dueCur=paidBGN=paidEUR=error=result=changeMain=changeAlt=null;
const d=document.getElementById.bind(document);

const dueEl=d("due"),curEl=d("dueCur"),bgnEl=d("paidBGN"),eurEl=d("paidEUR");
const err=d("error"),res=d("result"),main=d("changeMain"),alt=d("changeAlt");

function calc(){
  const due=parseFloat(dueEl.value)||0;
  const dueBGN=curEl.value==="EUR"?due*rate:due;
  const paid=(parseFloat(bgnEl.value)||0)+(parseFloat(eurEl.value)||0)*rate;
  let diff=paid-dueBGN;

  if(diff<-0.01){
    err.classList.remove("hidden");
    res.classList.add("hidden");
    return;
  }
  diff=Math.max(0,diff);
  err.classList.add("hidden");
  res.classList.remove("hidden");
  main.textContent=diff.toFixed(2)+" лв";
  alt.textContent=(diff/rate).toFixed(2)+" €";
}
[dueEl,curEl,bgnEl,eurEl].forEach(e=>e.addEventListener("input",calc));

/* === MANIFEST (INLINE) === */
const manifest={
  name:"DualPay",
  short_name:"DualPay",
  start_url:".",
  display:"standalone",
  background_color:"#0f2a1d",
  theme_color:"#14532D"
};
const mURL=URL.createObjectURL(new Blob([JSON.stringify(manifest)],{type:"application/manifest+json"}));
const ml=document.createElement("link");
ml.rel="manifest"; ml.href=mURL;
document.head.appendChild(ml);

/* === SERVICE WORKER (INLINE) === */
if("serviceWorker" in navigator){
  const sw=`
    const C="dualpay";
    self.addEventListener("install",e=>{
      e.waitUntil(caches.open(C).then(c=>c.addAll(["./"])))
    });
    self.addEventListener("fetch",e=>{
      e.respondWith(caches.match(e.request).then(r=>r||fetch(e.request)))
    });
  `;
  const swURL=URL.createObjectURL(new Blob([sw],{type:"text/javascript"}));
  navigator.serviceWorker.register(swURL);
}

/* === INSTALL BUTTON === */
let deferredPrompt;
const btn=d("installBtn");

window.addEventListener("beforeinstallprompt",e=>{
  e.preventDefault();
  deferredPrompt=e;
  btn.classList.remove("hidden");
});

btn.addEventListener("click",async()=>{
  btn.classList.add("hidden");
  deferredPrompt.prompt();
  await deferredPrompt.userChoice;
  deferredPrompt=null;
});
</script>

</body>
</html>
